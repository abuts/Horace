## Release Notes v4.0

This is version 4 of Horace, which contains major changes to the Horace code
produced within 3-years of PACE project development.
It is major upgrade from the Horace version 3.6.

Draft versions of these changes were used at ISIS in cycles: 2024/1&2

## Major changes.

As part of major new features we would emphasise:

  - Fully changed internal structure of sqw objects. In particular:

  - allows usage of different projections (images in different coordinate system)

  - provides the same way of operating with sqw objects regardless of the way they are stored internally (the whole sqw object can stay in memory or , if the pixel data can not fit memory, the object can be stored on files).

  - New types of cuts using spherical and cylindrical projections

  - New symmetry operations and ways of symmetrizing sqw objects.

  - Extended parallel operations, new parallel algorithms for sqw_eval and Tobyfit.

  - It writes sqw objects in a new more efficient and flexible binary format though still can read of previous versions of sqw files. sqw files produced by Horace-4 can not be read by previous versions of Horace.


## Major internal changes, which may break compatibility with old Horace scripts
 -- Renamed `fake_sqw` to `dummy_sqw`
 
 -- `DnD` objects are fully refactored and constructed from `axes_block` class (property `axes`),
    `aProjection` class (property   `proj`) and three datasets, namely `s,e` and `npix`
    containing signal, error and number of pixels contributed into a bin, as before.
    `axes_block` defines binning of these datasets and their physical meaning,
    while projection defines the transformation from pixels coordinate system to the
    coordinate system, defined by `axes_block`. Old interface (`iax,pax,iint,p etc.`)
    left for compatibility with existing algorithms and set as read-only interface.
 
 -- `multifit` and `tobyfit` are now able to be run in parallel through the 
    `hpc_config` `parallel_multifit` setting.
 
 -- `data_sqw_dnd` class (property `data` of `sqw` object) have been removed from
    `sqw` object and replaced by appropriate dimension `dnd` object. Pixels data 
    (`PixelData` class), which were the property of `data_sqw_dnd` class are now independent
    property of `sqw` object (property `pix`). Old and refactored `data_sqw_dnd` class left
    for compatibility with old `sqw` files, allowing the loading of old data from `.mat` files.
 
 -- Added benchmarking features under the `_benchmarking` folder which will run on CI
    or can be run by users using either the `benchmark_horace` script or by running
    individual benchmark functions. Documentation included in SMG 20
 
 -- Spawning parallel jobs with Herbert/C++ MPI no longer spawns inappropriate MATLAB
    threads oversubscribing the machine and causing slowdown.
 
 -- Slurm cluster handling has been rewritten to deal appropriately with multiple
    node requests and automatically handle threading.
 
 -- `threads` and `parallel_workers` have migrated from `hpc_config` to `parallel_config`
 
 -- `herbert_config` has been deprecated and features of `herbert_config`
    have migrated to `hor_config`
    
 -- `fit_sqw` function have been removed in favour of direct usage of `multifit_sqw` class
    and this class methods.
 
 -- Number of less substantial additions and improvement in algorithms and design 
    (more than 1000 competed tickets) refactoring and improving existing algorithms,
    providing various new features and making code much more modular to allow better
    maintenance and future Horace development.