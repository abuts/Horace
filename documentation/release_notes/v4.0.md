## Release Notes v4.0

This is version 4 of Horace, which contains major changes to the Horace code produced within 3-years of PACE project development. It is major upgrade from the Horace version 3.6.
Draft version of these changes were used in ISIS in cycles: 2024/1&2.

The code is tested against Matlab versions 2019b-2023b.

## Major changes.

As part of major new features we would emphasise:

  - Fully changed internal structure of sqw objects. In particular:

  - allows usage of different projections (images in different coordinate system)

  - provides the same way of operating with sqw objects regardless of the way they are stored internally (the whole sqw object can stay in memory or , if the pixel data can not fit memory, the object can be stored on files).

  - New types of cuts using spherical and cylindrical projections

  - New symmetry operations and ways of symmetrizing sqw objects.

  - Extended parallel operations, new parallel algorithms for sqw_eval and Tobyfit.

  - It writes sqw objects in a new more efficient and flexible binary format though still can read of previous versions of sqw files. sqw files produced by Horace-4 can not be read by previous versions of Horace.


## Breaking Changes
- Renamed `fake_sqw` to `dummy_sqw`
 
- Fully refactored `SQw` objects:
  - `data_sqw_dnd` class (property `data` of `sqw` object) has been removed from `sqw` object and replaced by appropriately dimensioned `dnd` object. 
  - Pixel data (`PixelData` class), which were a property of the `data_sqw_dnd` class are now an independent property of `sqw` object (`pix` property). 
  - Old and refactored `data_sqw_dnd` class left for compatibility with old `sqw` files, allowing the loading of old data from `.mat` files.
 
 - Fully refactored`DnD` objects now made up of:
  - `axes_block` class (`axes` property),  defining binning of these datasets and their physical meaning,
  - `aProjection` class (`proj` property), defining the transformation from pixels coordinate system to the coordinate system, defined by `axes_block`.
  - and three datasets, namely `s,e` and `npix` containing signal, error and number of pixels contributed into a bin, as before. 
  - **NOTE:** Old interface (`iax`, `pax`, `iint`, `p`, etc.) left for compatibility with existing algorithms through read-only interface.
 
- `multifit` and `tobyfit` can be run in parallel through the `hpc_config` `parallel_multifit` setting.
  
- Added benchmarking in the `_benchmarking` folder which will run on CI or can be run by users using either the `benchmark_horace` script or by running individual benchmark functions. Documentation included in SMG 20.

- Spawning parallel jobs with Herbert/C++ MPI no longer spawns inappropriate MATLAB threads oversubscribing the machine and causing slowdown.
 
- Slurm cluster interface has been rewritten to deal appropriately with multiple node requests and automatically handle threading.
 
- `threads` and `parallel_workers` have migrated from `hpc_config` to `parallel_config`
 
- `herbert_config` has been deprecated and features of `herbert_config` have migrated to `hor_config`
 
- More than 1,000 additional tasks making substantial additions and improvements to algorithms and design: refactoring and improving existing algorithms, providing new features and making code more modular to facilitate maintenance and future Horace development.